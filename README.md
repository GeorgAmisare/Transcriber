# Transcriber
Минималистичный десктопный транскрибатор встреч с диаризацией спикеров.
[![CI](https://github.com/<owner>/Transcriber/actions/workflows/tests.yml/badge.svg)](https://github.com/<owner>/Transcriber/actions/workflows/tests.yml)

## Демонстрация
*(добавить gif/скрин GUI — placeholder)*

## Содержание
1. [Описание](#описание)
2. [Функциональность](#функциональность)
3. [Установка](#установка)
4. [Быстрый старт](#быстрый-старт)
5. [Использование](#использование)
6. [Конфигурация](#конфигурация)
7. [Архитектура](#архитектура)
8. [Разработка и вклад](#разработка-и-вклад)
9. [Дорожная карта](#дорожная-карта)
10. [Лицензия](#лицензия)
11. [Благодарности](#благодарности)

## Описание
Приложение упрощает преобразование записей встреч в структурированный текст.
Пользователь перетаскивает файл в окно, после чего транскрибатор извлекает
аудио, распознаёт речь моделью Whisper, определяет спикеров и сохраняет
итоговый файл. Программа подходит тем, кому требуется быстрый фоллоу‑ап
после совещания.

## Функциональность
- Drag‑n‑drop GUI на PyQt5
- Извлечение и нормализация аудио через FFmpeg
- Распознавание речи Whisper
- Диаризация с помощью pyannote.audio
- Объединение сегментов и экспорт в UTF‑8 `.txt`
- Логирование в файл и интерфейс

## Установка
```bash
git clone <repo-url>
cd Transcriber
python -m venv .venv
# Windows:
.venv\Scripts\activate
# Linux/Mac:
source .venv/bin/activate
pip install -r requirements.txt
```

### Системные зависимости

```bash
# FFmpeg:
# Windows
winget install Gyan.FFmpeg
# Linux
sudo apt install ffmpeg
# macOS
brew install ffmpeg
```

## Быстрый старт

```bash
python app.py
```

Перетащите аудио или видео в окно и дождитесь сообщения о готовности.
Рядом с исходником появится текстовый файл с расшифровкой.

## Использование

* Вход: MP4, MOV, AVI, MKV, WMV, WebM, FLV, M4V, TS/MTS, MP3, WAV, AAC/M4A,
  WMA, OGG/OGA, FLAC, AMR, AIFF/AIFC, Opus, CAF и др.
* Выход: `.txt` с строками вида `[HH:MM:SS — HH:MM:SS] Спикер N: текст`.
* Ограничения: длительность ≤90 минут, размер ≤2 ГБ.
* Файлы сохраняются рядом с оригиналом с суффиксом `_transcript`.

### Переменные окружения

```bash
# Требуется для загрузки весов Whisper и pyannote.audio
export HF_TOKEN=<ваш_токен>
export HUGGINGFACE_HUB_TOKEN=$HF_TOKEN  # при необходимости
# Дополнительно для локальных тестов
export TEST_WITH_MATERIALS=1
```

*.env* пример:
```
HF_TOKEN=ваш_токен
TEST_WITH_MATERIALS=0
```
Укажите путь к `.env` в VS Code через `python.envFile`, чтобы переменные
подхватывались при запуске.

### Windows vs Linux/macOS

Пути формируются через `pathlib`, поэтому Windows принимает прямые слэши `/`,
но рекомендуется оперировать объектами `Path` для кроссплатформенности.

## Конфигурация

* Модель Whisper по умолчанию: `small` (доступны tiny/base/small/medium/large).
* Временные файлы удаляются автоматически после обработки.
* Ошибки выводятся в лог и на экран.

## Архитектура

Основной поток данных:

```
+--------------------+        +-------------------------+
|  Пользователь      |        |        GUI (PyQt)       |
|  drag-n-drop файл  +------->+  Старт пайплайна        |
+--------------------+        |  Статусы/ошибки         |
                              |  Путь к файлу           |
                              +-----------+-------------+
                                          |
                                          v
                              +-----------+-------------+
                              |  MediaProc (FFmpeg)     |
                              |  - Извлечение аудио     |
                              |  - Нормализация (PCM)   |
                              +-----------+-------------+
                                          |
                                          v
                              +-----------+-------------+
                              |  ASR (Whisper)          |
                              |  - Распознавание        |
                              |  - Таймкоды фраз        |
                              +-----------+-------------+
                                          |
                                          v
                              +-----------+-------------+
                              |  Diarization (pyannote) |
                              |  - Кластеры спикеров    |
                              |  - Таймсегменты         |
                              +-----------+-------------+
                                          |
                                          v
                              +-----------+-------------+
                              |  Postprocess            |
                              |  - Слияние ASR+диары    |
                              |  - Правила строк/имён   |
                              +-----------+-------------+
                                          |
                                          v
                              +-----------+-------------+
                              |  Export                 |
                              |  - .txt (UTF-8)         |
                              +-----------+-------------+
                                          |
                                          v
                              +-----------+-------------+
                              |  GUI Result             |
                              |  - Путь к файлу         |
                              |  - Готово/ошибки        |
                              +-------------------------+
```

Дополнительные схемы см. в [AGENTS.MD](AGENTS.MD).

## Разработка и вклад

```bash
pytest -vv
# диагностика причин skip:
pytest -vv -rs
```

* Стиль: PEP8, black, isort, flake8, pre-commit (ruff)
* Коммиты: Conventional Commits
* Ветки: feat/*, fix/*, chore/*
* CI запускает pre-commit и `pytest` на Python 3.10 и 3.11

## Дорожная карта

* [x] GUI drag‑n‑drop и логирование
* [x] Пайплайн: FFmpeg → Whisper → pyannote → экспорт
* [ ] Экспорт в форматы `.srt` / `.md`
* [ ] Настройки модели и сохранения через GUI
* [ ] Сборка и дистрибуция под все ОС
  (см. подробности в `AGENTS.MD`)

## Лицензия

MIT — см. LICENSE

## Благодарности

* [OpenAI Whisper](https://github.com/openai/whisper)
* [pyannote.audio](https://github.com/pyannote/pyannote-audio)
* [FFmpeg](https://ffmpeg.org/)
