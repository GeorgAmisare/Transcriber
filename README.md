# Transcriber

Программа для автоматической расшифровки аудио- и видеозаписей встреч. Приложение имеет минимальный интерфейс: достаточно перетащить файл в окно, после чего в соседнем каталоге появится текстовый файл стенограммы с указанием спикеров.

## Возможности
- Drag-n-drop файлов в небольшое окно (PyQt).
- Автоматическое извлечение звука, нормализация и транскрибация (Whisper).
- Диаризация спикеров на основе `pyannote.audio`.
- Результат в `.txt` (UTF-8) рядом с исходным файлом.

## Требования к окружению
- Python 3.10+
- Установленный [FFmpeg](https://ffmpeg.org/)
- Подключение к интернету

## Установка и настройка
```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

Перед запуском создайте файл `.env` на основе `example.env` и укажите токен Hugging Face:

```bash
cp example.env .env
# В .env укажите:
# HF_TOKEN=ваш_токен
# TEST_WITH_MATERIALS=0  # установить 1 для расширенных тестов
```

Файл `.env` не добавляется в репозиторий, но используется приложением и тестами.

## Запуск
```bash
python app.py
```

Ограничения входных файлов:
- длительность до 90 минут;
- размер не более 2 ГБ;
- поддерживаются популярные форматы: MP4, MOV, AVI, MKV, MP3, WAV и др.

Итоговая расшифровка сохраняется в файл `[имя]_transcript.txt` рядом с исходником.

## Whisper и токен Hugging Face
Модель Whisper загружается из репозитория Hugging Face с использованием токена доступа. При запуске приложение автоматически читает токен из `.env` и выполняет вход в `huggingface_hub`.

## Запуск тестов
Перед запуском тестов задайте переменную окружения `HF_TOKEN`. При необходимости включите проверку локальных медиафайлов, установив `TEST_WITH_MATERIALS=1`:

```bash
export HF_TOKEN=ваш_токен
# export TEST_WITH_MATERIALS=1  # проверять локальные медиафайлы
pytest
```

Тесты, помеченные маркером `needs_hf`, будут пропущены при отсутствии `HF_TOKEN`.

## Работа в VS Code
В каталоге `.vscode` находятся готовые конфигурации:
1. Открыть папку проекта в VS Code.
2. На вкладке **Run and Debug** (`Ctrl+Shift+D`) выбрать:
   - **Запуск приложения** — старт `app.py`;
   - **Запуск тестов** — `pytest`;
   - **Сборка релиза** — `build.py`.

Перед запуском тестов убедитесь, что `HF_TOKEN` задан.

## Сборка под Windows
Для получения исполняемого файла установите зависимости и `pyinstaller`, затем выполните скрипт сборки:

```bash
pip install -r requirements.txt
pip install pyinstaller
python build.py
```

В каталоге `dist` появится `transcriber.exe`, который можно запускать двойным щелчком или из терминала:

```bash
dist\transcriber.exe
```

Скрипт `build.py` добавляет в сборку данные пакетов `lightning_fabric` и `pytorch_lightning`, предотвращая ошибку `FileNotFoundError: version.info`. При ручном использовании `pyinstaller` добавьте флаги `--collect-data lightning_fabric --collect-data pytorch_lightning`.

## Структура проекта
```
transcriber/
├─ app.py                # точка входа (GUI + оркестрация)
├─ gui/                  # интерфейс
├─ core/                 # обработка медиа, транскрибация и диаризация
├─ utils/                # вспомогательные модули
├─ tests/                # тесты
└─ build.py              # сборка исполняемого файла
```

## Обновление документации
README необходимо актуализировать при добавлении новой функциональности.

